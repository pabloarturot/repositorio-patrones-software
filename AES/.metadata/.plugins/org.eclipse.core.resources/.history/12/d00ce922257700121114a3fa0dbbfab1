package com.greenhouse.forwader;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;

import com.greenhouse.base.Message;
import com.greenhouse.util.MarshallingUtil;
import com.greenhouse.util.NetworkInfoUtil;


public class UDPForwarder implements Forwarder{

	 @Override
	    public void enviar(Message message) throws IOException {
	        
		 	NetworkInfoUtil.getBundle();
		 	String clientHost = NetworkInfoUtil.getProp(NetworkInfoUtil.CLIENT_HOST);
		 	String serverHost = NetworkInfoUtil.getProp(NetworkInfoUtil.SERVER_HOST);
		 	Integer clientPort = NetworkInfoUtil.getPropAs(NetworkInfoUtil.CLIENT_PORT, Integer.class);
		 	Integer serverPort = NetworkInfoUtil.getPropAs(NetworkInfoUtil.SERVER_PORT, Integer.class);
	        
	        byte[] byteArray = MarshallingUtil.toByteArray(message);
	        
	        DatagramSocket socket = new DatagramSocket(clientPort, InetAddress.getByName(clientHost));
	        
	        DatagramPacket packet = new DatagramPacket(
	        		byteArray,
	        		byteArray.length,
	                InetAddress.getByName(serverHost),
	                serverPort);
	        
	        socket.send(packet);
	        socket.close();      
	        
	    }
}
